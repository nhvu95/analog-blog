---
title: 'On The Ground. A journey to stand on my own feet'
description: 'V√†i th√°ng tr∆∞·ªõc m√¨nh v·ª´a nh·∫≠n m·ªôt ho√° ƒë∆°n h∆°n 200$ t·ª´ AWS ch·ªâ v√¨ qu√™n cmn t·∫Øt 2 c√°i services demo khi ph·ªèng v·∫•n t√¨m vi·ªác. Qu√° x√≥t ti·ªÅn, v·∫≠y l√† 1 con ƒë·ªó ngh√®o kh·ªâ nh∆∞ m√¨nh l·∫°i t√¨m ƒë∆∞·ªùng quay v·ªÅ m·∫∑t ƒë·∫•t. M·ªôt ph·∫ßn c≈©ng v√¨ t√≤ m√≤ nh·ªØng h·ªá th·ªëng on-premise tr∆∞·ªõc gi·ªù h·ªç deploy v√† public ra nh∆∞ th·∫ø n√†o.'
date_start: 2022/10/08
date_end: 2022/10/08
published: true
image: 'https://i.imgur.com/yDaMrZV.png'
header_image: 'https://i.imgur.com/VgWRVd8.jpg'
tags: ['DevOps','Docker','Vietnamese']
priority: 0
link: /blog/on-the-ground
slug: on-the-ground
location: 'Hanoi, Vietnam'
---

_**H·ªìi ·ªü c√¥ng ty c≈©, m√¨nh c≈©ng hay ph·∫£i deploy c√°c d·ª± √°n cho Team dev v√† c·∫£ team Test. Nh∆∞ng ch·ªß y·∫øu vi·ªác deploy s·∫Ω ch·ªâ xoay quanh ·ªü c√°c local server trong c√πng m·∫°ng LAN, ho·∫∑c n·∫øu kh√¥ng th√¨ s·∫Ω s·ª≠ d·ª•ng c√°c d·ªãch v·ª• cloud ki·ªÉu nh∆∞ Azure Storage, Azure Function, AWS EC2, AWS RDS, Github Page. Th·∫ø n√™n ƒë√¢y l√† l·∫ßn ƒë·∫ßu ti√™n m√¨nh t·ª± public 1 server, v√† deploy ·ªü ƒë√≥.  
Sau khi d√πng th·ª≠ m√¨nh c≈©ng th·∫•y r·∫±ng, kh√¥ng ch·ªâ ·ªü tr√™n cloud, ·ªü m·∫∑t ƒë·∫•t c≈©ng c√≥ nhi·ªÅu c√°i hay ƒë√≥ ch·ª© , v√† n·∫øu b·∫°n ƒëang ƒë·ªçc b√†i vi·∫øt n√†y, th√¨ n√≥ ƒëang ƒë∆∞·ª£c serve ho√†n to√†n t·ª´ m√°y t√≠nh c·ªßa m√¨nh ƒë√≥ üòÅ**_

M√¨nh ƒë√£ th·ª≠ v·ªõi 2 gi·∫£i ph√°p. C√°i ƒë·∫ßu ti√™n kh√¥ng th·ª±c s·ª± th√†nh c√¥ng n√™n sau ƒë√≥ m√¨nh ƒë√£ ƒë·∫øn v·ªõi gi·∫£i ph√°p th·ª© 2, v√† ƒë√¢y c≈©ng l√† c√°ch m√† m√¨nh th·∫•y ·ªïn h∆°n v√† quy·∫øt ƒë·ªãnh s·ª≠ d·ª•ng n√≥. Th·∫ø n√™n, n·∫øu c√°c b·∫°n kh√¥ng c√≥ th·ªùi gian r·∫£nh ƒë·ªÉ ngh·ªãch m·∫•y c√°i t√†o lao v√† mu·ªën t√¨m 1 gi·∫£i ph√°p t·ªët v√† work ngay l·∫≠p t·ª©c, m√¨nh recommend gi·∫£i ph√°p th·ª© 2, b·∫°n c√≥ th·ªÉ scroll xu·ªëng th·∫≥ng [**gi·∫£i ph√°p th·ª© 2**](#solution).

## **I. Gi·∫£i ph√°p 1: T·ª± host v√† t·ª± facing internet.**

Nh·ªØng th·ª© m√¨nh ƒë√£ l√†m v·ªõi gi·∫£i ph√°p n√†y sau 1 bu·ªïi m√≤ tr√™n internet v√† 2 bu·ªïi t√¨m solution cho c√°i r·∫Øc r·ªëi m√† m√¨nh g·∫∑p ph·∫£i
 1. **ƒê·∫ßu ti√™n m√¨nh set static IP cho con m√°y t√≠nh c·ªßa m√¨nh & m·ªü port ·ªü tr√™n windows firewall.**
 2. **M·ªü forward port ·ªü tr√™n modem setting (192.168.1.1).**
 3. **C√†i Docker v√† ch·∫°y Docker/nginx ƒë·ªÉ serve app.**
 4. **Setup DDNS t·ª´ domain c·ªßa m√¨nh tr√™n Google Domain v·ªÅ m√°y c√° nh√¢n c·ªßa m√¨nh. Tools / D·ªãch v·ª• m√† m√¨nh ƒë√£ t·ª≠ l√† NoIP, DDclient v√† DDNS Updated Admin.**
 5. **Ki·ªÉm tra th·ª≠ v√† ph√°t hi·ªán l·ªói.**

Gi·∫£i ph√°p n√†y ch·∫°y ·ªïn cho ƒë·∫øn khi m√¨nh ph√°t hi·ªán ra to√†n b·ªô web app c·ªßa m√¨nh kh√¥ng th·ªÉ ƒë∆∞·ª£c truy c·∫≠p t·ª´ c√°c thi·∫øt b·ªã di ƒë·ªông. Sau khi nh·ªù support t·ª´ c√°c b·∫°n senior Dev-Ops trong group [**DevOps VietNam**](https://www.facebook.com/groups/608821322646056) v√† ki·ªÉm nghi·ªám c√° nh√¢n, m√¨nh ƒë√£ t√¨m ra l√Ω do, l√Ω do m√¨nh s·∫Ω n√≥i chi ti·∫øt trong ph·∫ßn h∆∞·ªõng d·∫´n c·ªßa gi·∫£i ph√°p 1 n√†y.

## **II. Gi·∫£i ph√°p 2: T·ª± host v√† d√πng Cloudflare ƒë·ªÉ facing v·ªõi internet th√¥ng qua Cloudflare tunnel.**

Gi·∫£i ph√°p n√†y ƒë·∫øn v·ªõi m√¨nh sau khi m√¨nh ƒëƒÉng c√¢u h·ªèi l√™n group [**DevOps VietNam**](https://www.facebook.com/groups/608821322646056). C≈©ng t·ª´ g·ª£i √Ω v√† gi√∫p ƒë·ª° t·ª´ m·ªôt ng∆∞·ªùi em (b·∫°n) [**Ph·∫°m S∆°n**](https://www.facebook.com/sonpnuet), v√† c·∫£ comment t·ª´ m·ªôt v√†i senior ·ªü ƒë√¢y, m√¨nh ƒë√£ hi·ªÉu v·∫•n ƒë·ªÅ v√† th·ª≠ c√°ch n√†y.

1. **S·∫µn con Docker v√† Docker - nginx ƒë∆∞·ª£c c·∫•u h√¨nh s·∫µn t·ª´ b∆∞·ªõc 3 c·ªßa Gi·∫£i ph√°p 1. M√¨nh ti·∫øp t·ª•c s·ª≠ d·ª•ng n√≥**
2. **C·∫•u h√¨nh con domain (Google Domain) c·ªßa m√¨nh sang d√πng DNS server c·ªßa Cloudflare.**
3. **T·∫°o Application tr√™n Cloudflare**
4. **T·∫°o Tunnel v√† connect server ƒë·∫øn Cloudflare tunnel.**

M√¨nh kh√¥ng ∆∞·ªõc bi·∫øt gi·∫£i ph√°p n√†y s·ªõm h∆°n, m√¨nh c√≤n th·∫•y may v√¨ nh·ªù ƒë√£ th·ª≠ gi·∫£i ph√°p 1 m√† m√¨nh h·ªçc ƒë∆∞·ª£c kh√° nhi·ªÅu th·ª© hay ho.
_______________
# **I. T·ª± host v√† t·ª± facing internet.**

**Chu·∫©n b·ªã:**
- M√°y t√≠nh
- Quy·ªÅn truy c·∫≠p modem
- 1 Domain

M√°y t√≠nh m√¨nh recommend c√°c b·∫°n n√™n k·∫øt n·ªëi m·∫°ng th√¥ng qua c√°p LAN, v√¨ k·∫øt n·ªëi c·ªßa n√≥ s·∫Ω ·ªïn ƒë·ªãnh h∆°n qua wifi, v√† c≈©ng ti·ªán cho vi·ªác c·∫•u h√¨nh h∆°n.

## **1. Set IP Tƒ©nh**

ƒê·∫ßu ti√™n l√† set IP tƒ©nh cho con m√°y ƒë√£, IP tƒ©nh gi√∫p IP kh√¥ng b·ªã thay ƒë·ªïi, v√† ƒë·ªÉ modem c√≥ th·ªÉ forward port ƒë·∫øn m√°y c·ªßa ch√∫ng ta trong m·∫°ng LAN m√† kh√¥ng s·ª£ IP b·ªã thay ƒë·ªïi.

C√°c b·∫°n ·∫•n `Windows + R` g√µ `ncpa.cpl` r·ªìi ·∫•n OK
Ho·∫∑c t·ª´ thanh address c·ªßa windows Explorer g√µ `Control Panel\All Control Panel Items\Network Connections`

Chu·ªôt ph·∫£i v√†o m·∫°ng b·∫°n ƒëang s·ª≠ d·ª•ng, (·ªû ƒë√¢y m√¨nh d√πng m·∫°ng lan Ethernet), ch·ªçn Properties

Ti·∫øp ƒë√≥ m·ªôt dialog s·∫Ω hi·ªán l√™n, ch·ªçn > `TCP/IPv4` ch·ªçn ti·∫øp > `Properties`

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/oMc7lEf.png"/>
</figure>

Ti·∫øp t·ª•c ·∫•n `Windows + R` g√µ `cmd` r·ªìi ·∫•n OK/Enter. Nh·∫≠p `ipconfig /all`.

```bash
> ipconfig /all

Ethernet adapter Ethernet:

   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : Intel(R) Ethernet Connection (2) I219-V
   Physical Address. . . . . . . . . : 30-9C-23-68-E4-08
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2405:4802:377:6f30:d4e9:c778:f58:6204(Preferred)
   IPv6 Address. . . . . . . . . . . : 2405:4802:377:6f30:ffff:ffff:ffff:ffed(Preferred)
   Lease Obtained. . . . . . . . . . : Friday, October 7, 2022 8:11:43 AM
   Lease Expires . . . . . . . . . . : Friday, October 7, 2022 9:30:18 PM
   Temporary IPv6 Address. . . . . . : 2405:4802:377:6f30:407f:9ea6:98f8:6ffc(Preferred)
   Link-local IPv6 Address . . . . . : fe80::d4e9:c778:f58:6204%3(Preferred)
   IPv4 Address. . . . . . . . . . . : 192.168.1.50(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : fe80::7e9f:7ff:fea0:9da8%3
                                       192.168.1.1
   DHCPv6 IAID . . . . . . . . . . . : 321952803
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-23-33-8F-9E-30-9C-23-68-E4-08
   DNS Servers . . . . . . . . . . . : fe80::1%3
                                       1.1.1.1
                                       1.0.0.1
   NetBIOS over Tcpip. . . . . . . . : Enabled

```

K√©o l√™n ph·∫ßn Ethernet ƒë√∫ng v·ªõi m·∫°ng m√† b·∫°n ƒëang s·ª≠ d·ª•ng, b·∫°n s·∫Ω th·∫•y `Default Gateway` l√† 1 d√£y IP c√≥ d·∫°ng `192.168.1.1`. IP n√†y c√≥ th·ªÉ s·∫Ω kh√°c ·ªü tr√™n m√°y c·ªßa b·∫°n. 
Nh∆∞ng cho d√π n√≥ l√† m·ªãa g√¨, ch·ªâ c·∫ßn tƒÉng s·ªë cu·ªëi l√™n trong kho·∫£ng t·ª´ 2-223. Tr∆∞·ªùng h·ª£p n√†y m√¨nh ƒë·ªÉ static IP c·ªßa m√¨nh l√† `192.168.1.50`.

Quay tr·ªü v·ªÅ dialog l√∫c n√£y ƒëi·ªÅn IP address l√† IP static m·ªõi n√†y, c√≤n Default Gateway v√† Subnet Mask gi·ªëng nh∆∞ trong command line

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/hwX1YTs.png"/>
</figure>

N·∫øu c√≥ ng∆∞·ªùi s·ª≠ d·ª•ng IP n√†y r·ªìi th√¨ sao? Y√™n t√¢m, n·∫øu c√≥ ng∆∞·ªùi d√πng th√¨ n√≥ s·∫Ω l·ªói ngay, hi·ªán warning üòÜbi·∫øt ngay, thay th√†nh IP kh√°c l√† ƒë∆∞·ª£c.

Ph·∫ßn DNS server th√¨ m√¨nh ƒëang d√πng DNS server c·ªßa Cloudflare, c√°c b·∫°n ƒëi·ªÅn gi·ªëng th·∫ø c≈©ng ƒë∆∞·ª£c. ∆Øu ƒëi·ªÉm c·ªßa c√°i n√†y l√† v√†o ƒë∆∞·ª£c Medium v√† m·∫•y trang c∆° b·∫£n b·ªã ch·∫∑n ·ªü VN.

&nbsp;
### **Ti·∫øp ƒë·∫øn vi·ªác ch√∫ng ta c·∫ßn l√†m l√† m·ªü port windows.** 

·∫§n ph√≠m `Windows + S` nh·∫≠p `Firewall`. Ch·ªçn **Windows Defender Firewall with Advanced Security**

T·ª´ tab b√™n tr√°i ch·ªçn `Inbound Rules` > `New Rule`. V√† t·∫°o m·ªõi 1 rule, ch·ªçn `Port` > `Next`

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/IP33IkF.png"/>
</figure>

Ch·ªçn protocol m√† b·∫°n mu·ªën m·ªü, ·ªü ƒë√¢y m√¨nh s·∫Ω m·ªü TCP v·ªõi c√°c c·ªïng l·∫ßn l∆∞·ª£t l√† 
80, 443, 5000-5010. Trong ƒë√≥ 80 l√† c·ªïng m·∫∑c ƒë·ªãnh c·ªßa windows, M·ªü th√™m 443 ƒë·ªÉ support cho HTTPS, v√† th√™m 5000 ƒë·ªÉ cho Docker.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/8YdCY36.png"/>
</figure>

- ·ªû b∆∞·ªõc Action b·∫°n ch·ªçn Allow the Connection
- B∆∞·ªõc Profile c·ª© ƒë·ªÉ m·∫∑c ƒë·ªãnh
- B∆∞·ªõc Name b·∫°n ƒëi·ªÅn t√™n tu·ª≥ √Ω. M√¨nh th√¨ ƒë·ªÉ l√† SelfHostRule cho d·ªÖ t√¨m

=> **Ti·∫øp ƒë·∫øn t·∫°o 1 rule t∆∞∆°ng t·ª± cho `Outbound Rules`**


## **2. M·ªü Port Forward ·ªü Modem.**

T·ª´ C·ª≠a s·ªï browser, c√°c b·∫°n g√µ 192.168.1.1 ƒê√¢y l√† IP m·∫∑c ƒë·ªãnh ƒë·ªÉ c·∫•u h√¨nh modem, M·ªói lo·∫°i modem s·∫Ω c√≥ 1 ip kh√°c nhau. C√°c b·∫°n c√≥ th·ªÉ t√¨m th·∫•y n√≥ ·ªü m·∫∑t ƒë√°y c·ªßa modem.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/zlTqhP8.png"/>
</figure>

Th∆∞·ªùng th√¨ t√†i kho·∫£n v√† m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh s·∫Ω l√† `admin / admin`. Nh∆∞ng ƒë√¥i khi th√¨ n√≥ ƒë√£ b·ªã k·ªπ thu·∫≠t vi√™n ƒë·ªïi m·∫≠t kh·∫©u r·ªìi.  
N·∫øu l√† modem c·ªßa FPT th√¨ m·∫≠t kh·∫©u th∆∞·ªùng s·∫Ω l√† 7 ch·ªØ s·ªë cu·ªëi trong m√£ h·ª£p ƒë·ªìng internet ( b·∫°n c√≥ th·ªÉ t√¨m th·∫•y ·ªü trong ho√° ƒë∆°n m·∫°ng). V√≠ d·ª• M√£ h·ª£p ƒë·ªìng l√† `HHNAAP1234` th√¨ m·∫≠t kh·∫©u s·∫Ω l√† `AAP1234`

D√π l√† modem c·ªßa h√£ng n√†o c≈©ng s·∫Ω c√≥ ph·∫ßn Security Setup v√† c≈©ng s·∫Ω c√≥ ph·∫ßn Port Forwarding

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/Iu8MJUS.png"/>
</figure>

C√°c b·∫°n ƒëi·ªÅn nh∆∞ h√¨nh ƒë·ªÉ m·ªü c·∫£ TCP/UDP cho Port 80. ·ªû ph·∫ßn IP address th√¨ b·∫°n ƒëi·ªÅn static IP c·ªßa b·∫°n.
Ph·∫ßn WAN Port c·ªßa m√¨nh v√¨ m√¨nh hay d√πng nh·ªØng c·ªïng n√†y n√™n m√¨nh m·ªü port range t·ª´ 20 ƒë·∫øn 80. N·∫øu kh√¥ng mu·ªën m·ªü range c√°c b·∫°n c√≥ th·ªÉ ƒëi·ªÅn nguy√™n 80 th√¥i c≈©ng ƒë∆∞·ª£c

L√†m t∆∞∆°ng t·ª±, t·∫°o th√™m 1 c√°i v·ªõi Port 443 ƒë·ªÉ HTTPS c√≥ th·ªÉ ho·∫°t ƒë·ªông, v√† ƒëi·ªÅn nguy√™n 443 n·∫øu kh√¥ng mu·ªën public c√°c port kh√¥ng d√πng ƒë·∫øn

## 3. C√†i Docker v√† c·∫•u h√¨nh Docker/Nginx

Vi·ªác c√†i Docker th√¨ kh√° ƒë∆°n gi·∫£n r·ªìi, ch·ªâ vi·ªác l√™n [**trang ch·ªß**](https://www.docker.com/) v√† t·∫£i v·ªÅ th√¥i.

Ki·ªÉm tra c√†i ƒë·∫∑t docker th√†nh c√¥ng hay ch∆∞a b·∫±ng command

```bash
> docker --version
~~~~~~~~~~~~~~~~~~~~
Docker version 20.10.17, build 100c701
```

ƒê·ªÉ c√†i nginx ch·∫°y nginx tr√™n docker, ta d√πng command

```bash
> docker pull nginx
```

Th·ª±c ra ph·∫ßn t·ªën th·ªùi gian nh·∫•t c·ªßa m√¨nh trong b∆∞·ªõc n√†y ƒë√≥ ch√≠nh l√† c·∫•u h√¨nh `nginx` cho sub domain ( wildcard DNS), ti·∫øp ƒë√≥ l√† vi·ªác c·∫•u h√¨nh SSL cho n√≥.

T·∫°o 1 Dockerfile ki·ªÉu nh∆∞ th·∫ø n√†y

```bash
# Dockerfile
# STAGE3: Run
FROM nginx:latest
COPY nginx.conf /etc/nginx/nginx.conf
RUN mkdir /etc/nginx/sites-enabled
COPY ./webrtc/f2f.nhvu95.com.conf /etc/nginx/sites-available/f2f.nhvu95.com
COPY ./webrtc/dist/webrtc /usr/share/nginx/html/f2f.nhvu95.com
COPY ./scully-personal-website/nhvu95.com.conf /etc/nginx/sites-available/nhvu95.com
COPY ./scully-personal-website/dist/static /usr/share/nginx/html/nhvu95.com
RUN ln -s /etc/nginx/sites-available/nhvu95.com /etc/nginx/sites-enabled/
RUN ln -s /etc/nginx/sites-available/f2f.nhvu95.com /etc/nginx/sites-enabled/
```

Gi·∫£i th√≠ch qua m·ªôt ch√∫t v·ªÅ dockerfile c·ªßa m√¨nh, l√∫c ƒë·∫ßu ƒë√¢y l√† m·ªôt dockerfile multi-stage. L√∫c ƒë·∫ßu m√¨nh s·∫Ω c√≥
- STAGE1: build domain nhvu95.com 
- STAGE2: build sub domain f2f.nhvu95.com
- STAGE3: initialize nginx

Nh∆∞ng sau m√¨nh nh·∫≠n ra l√† vi·ªác d√πng multi-stage ƒë·ªÉ build code (STAGE1 / STAGE2) trong code s·∫Ω t·ªën r·∫•t nhi·ªÅu RAM, ho·∫∑c n√≥i ƒë√∫ng h∆°n l√† n√≥ chi·∫øm RAM cho Docker v√† sau ƒë√≥ kh√¥ng gi·∫£i ph√≥ng ƒëi üò• M·ªü Task Manager l√™n l√∫c n√†o `Vmmem` c≈©ng to√†n `~16Gb`.  
V√† khi m√¨nh thay ƒë·ªïi ·ªü project c·ªßa sub domain, m√¨nh c≈©ng ph·∫£i thay ƒë·ªïi c·∫£ project c·ªßa domain ch√≠nh. Ch·∫øt ti·ªát. Th·∫ø n√™n gi·ªù Dockerfile ch·ªâ c√≤n l·∫°i stage 3 n√†y.

ƒê√¢y l√† c·∫•u tr√∫c project c·ªßa m√¨nh v·ªõi Dockerfile n√†y

```bash
>   - Dockerfile 
    - nginx.conf    # nginx root config
    - certbot/nhvu95.com/* # Folder store SSL certification
    - scully-personal-website
        - nhvu95.com.conf # nhvu95.com nginx configuration file
        - dist/static/    # nhvu95.com build folder
    - webrtc 
        - f2f.nhvu95.com.conf   # f2f.nhvu95.com nginx configuration file
        - dist/webrtc           # f2f.nhvu95.com build folder
```

C√°c b·∫°n c√≥ th·ªÉ th·∫•y l√†` Dockerfile, nginx.conf` v√† th∆∞ m·ª•c `certbot/nhvu95.com/*` s·∫Ω n·∫±m ·ªü root, ƒë√¢y c≈©ng s·∫Ω l√† n∆°i ch√∫ng ta s·∫Ω g·ªçi command ƒë·ªÉ build v√† ch·∫°y Docker

```bash
#nginx.conf
events{}
http {
    include /etc/nginx/mime.types;
    include /etc/nginx/sites-enabled/*;
}
```

```bash
#nhvu95.com.conf
server {
    listen 80 default_server;
    listen [::]:80 default_server ;

    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;
    ssl_certificate     cert/fullchain.pem;
	ssl_certificate_key cert/privkey.pem;

    root /usr/share/nginx/html/nhvu95.com;
    index index.html;
    server_name nhvu95.com www.nhvu95.com;
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

```bash
#f2f.nhvu95.com.conf
server {
    listen 80;
    listen [::]:80;

    listen 443 ssl;
    listen [::]:443 ssl;
    ssl_certificate     cert/fullchain.pem;
	ssl_certificate_key cert/privkey.pem;

    root /usr/share/nginx/html/f2f.nhvu95.com;
    index index.html;
    server_name f2f.nhvu95.com www.f2f.nhvu95.com;
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

Nh∆∞ c√°c b·∫°n c√≥ th·ªÉ th·∫•y th√¨ ·ªü ƒë√¢y c√≤n c√≥ `fullchain.pem; privkey.pem;`. ƒê√¢y ch√≠nh l√† c√°c ch·ª©ng ch·ªâ SSL ƒë∆∞·ª£c generate ra t·ª´ [**Certbot**](https://certbot.eff.org/instructions?ws=other&os=windows) v·ªõi command:

```bash
certbot certonly --standalone -d nhvu95.com,f2f.nhvu95.com,soundmemos.nhvu95.com,api.nhvu95.com --expand
```

T·ª´ kho√° expand ·ªü ƒë√¢y d√πng trong tr∆∞·ªùng h·ª£p b·∫°n ƒë√£ c√≥ cert cho `nhvu95.com` v√† mu·ªën "expand" n√≥ ra ƒë·ªÉ d√πng cho c·∫£ `f2f.nhvu95.com`.

N·∫øu kh√¥ng c√≥ g√¨ thay ƒë·ªïi th√¨ certbot s·∫Ω t·ª± ƒë·ªông l∆∞u SSL cert cho b·∫°n ·ªü 
`C:\Certbot\live`. Copy ch√∫ng n√≥ v·ªÅ v√† d√πng th√¥i.

M·ªü th∆∞ m·ª•c ch·ª©a Dockerfile (th∆∞ m·ª•c root b√™n tr√™n), chu·ªôt ph·∫£i, ch·ªçn `powershell` v√† ch·∫°y command d∆∞·ªõi ƒë√¢y ƒë·ªÉ build Docker image, nh·ªõ gi·ªØ d·∫•u ch·∫•m cu·ªëi command

```bash
docker build -t <image_name> .

#ex: docker build -t self-host-image .
```

ƒê·ªÉ ch·∫°y docker, b·∫°n s·ª≠ d·ª•ng 2 comman sau.
Command th·ª© nh·∫•t ƒë·ªÉ t·∫°o m·ªôt network, sau n√†y ch√∫ng ta s·∫Ω d√πng chung n√≥ v·ªõi `Cloudflare tunnel` ·ªü gi·∫£i ph√°p th·ª© 2

```bash
docker network create tunnel

docker run --detach --restart unless-stopped --network tunnel --name <container_name> -v ${PWD}/certbot/nhvu95.com:/etc/nginx/cert -p 80:80 -p 443:443 <image_name>

#ex: docker run  --detach --restart unless-stopped --network tunnel --name self-host-container -v ${PWD}/certbot/nhvu95.com:/etc/nginx/cert -p 80:80 -p 443:443 self-host-image
```

Sau b∆∞·ªõc n√†y, n·∫øu m·ªçi th·ª© OK th√¨ b·∫°n ƒë√£ c√≥ th·ªÉ m·ªü website b·∫±ng `http://localhost/` r·ªìi ƒë√≥.
N·∫øu ƒëen, windows m·∫∑c ƒë·ªãnh s·∫Ω c√≥ 1 services s·ª≠ d·ª•ng port 80 n√†y v√† l√∫c n√†y th·ª© browser hi·ªán ra kh√¥ng ph·∫£i trang web c·ªßa b·∫°n. Vi·ªác b·∫°n c·∫ßn l√†m l√† t·∫Øt c√°i windows services ƒë√≥ ƒëi, y√™n t√¢m, kh√¥ng ·∫£nh h∆∞·ªüng g√¨ c·∫£.  

`Windows + S` > g√µ `services` > T√¨m c√°i services n√†y, chu·ªôt ph·∫£i v√†o properties v√† t·∫Øt n√≥ ƒëi

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/3iMouWf.png"/>
</figure>

==> L√∫c n√†y `http://localhost/` c·ªßa b·∫°n s·∫Ω v√†o b√¨nh th∆∞·ªùng

V√† c·ªông v·ªõi vi·ªác public port ·ªü c√°c b∆∞·ªõc tr∆∞·ªõc, l√∫c n√†y b·∫°n ƒë√£ c√≥ th·ªÉ truy c·∫≠p th√¥ng qua public ipv6. B·∫°n c√≥ th·ªÉ l·∫•y public IPv6 ·ªü [**ƒë√¢y**](https://whatismyipaddress.com/).  
B·∫°n c√≥ th·ªÉ d√πng IPv6 ƒë·ªÉ truy c·∫≠p website b·∫±ng ƒë·ªãa ch·ªâ nh∆∞ sau, nh·ªõ gi·ªØ 2 d·∫•u **[** **]** ·ªü tr√™n URL th√¨ m·ªõi ho·∫°t ƒë·ªông ƒë∆∞·ª£c

>https://[2405:4802:377:6f30:xxx:94fe:xxxx:50b5]/

Ti·∫øc l√† Public IPv4 c·ªßa b·∫°n l·∫•y ƒë∆∞·ª£c ·ªü c√°c trang web online th∆∞·ªùng s·∫Ω kh√¥ng ho·∫°t ƒë·ªông. C√°i m√† h·ªç tr·∫£ v·ªÅ th∆∞·ªùng s·∫Ω l√† public IPv4 c·ªßa ISP(c√°c nh√† cung c·∫•p d·ªãch v·ª• m·∫°ng) ch·ª© kh√¥ng ph·∫£i Public IPv4 m√°y t√≠nh c·ªßa b·∫°n.  
M·ªü modem setting l√™n, v√†o ph·∫ßn WAN Status, WAN Ipv4 ·ªü ƒë√¢y m·ªõi ƒë√∫ng l√† public IPv4 c·ªßa b·∫°n, v√† n·∫øu b·∫°n th·ª≠ v·ªõi IpV4 n√†y th√¨ n√≥ s·∫Ω ho·∫°t ƒë·ªông.
>http://21.xxx.xxx.100/

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/osMLL94.png"/>
</figure>

## **4. Setup DDNS**

Nh∆∞ b√¨nh th∆∞·ªùng, n·∫øu ch√∫ng ta d√πng Domain v·ªõi Record Type l√† `A/AAAA` v√† tr·ªè th·∫≥ng ƒë·∫øn public `IPv4/IPv6` th√¨ website c·ªßa ch√∫ng ta s·∫Ω ho·∫°t ƒë·ªông. H·ª≠m, nh∆∞ng chuy·ªán g√¨ s·∫Ω x·∫£y ra n·∫øu m·∫•t ƒëi·ªán? ho·∫∑c gi·∫£ server b·ªã reset v√† IP c·ªßa ch√∫ng ta b·ªã thay ƒë·ªïi?

C√≥ nh·ªØng d·ªãch v·ª• ki·ªÉu nh∆∞ `No-IP` s·∫Ω support vi·ªác n√†y, ho·∫∑c ch√∫ng ta c√≥ th·ªÉ d√πng c√°c tool nh∆∞ `ddclient`, `dydns` ho·∫∑c `DDNS Updater Admin`. 
V·ªÅ b·∫£n ch·∫•t c·ªßa ch√∫ng n√≥ l√† gi·ªëng nhau, ƒë·ªÅu l√† c√°c tool c√†i tr√™n server, khi ph√°t hi·ªán public IP thay ƒë·ªïi th√¨ th√¥ng b√°o cho DNS server qua API ho·∫∑c socket.  
M√¨nh ki·ªÉm tra th·ª≠ th√¨ `No-IP` m·∫•t ph√≠, `ddclient` v√† `dydns` th√¨ ch·∫°y qu√° l√† sida tr√™n docker. Cu·ªëi c√πng m√¨nh quy·∫øt ƒë·ªãnh d√πng `DDNS Updater Admin` v√¨ n√≥ free v√† ·ªïn ƒë·ªãnh.

ƒê·∫ßu ti√™n m√¨nh s·∫Ω c·ªë g·∫Øng setup domain tr√¥ng gi·ªëng nh∆∞ th·∫ø n√†y.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/qoSu7DL.png"/>
</figure>

Khi t·∫°o DDNS h·ªç s·∫Ω cho m√¨nh account v√† key ƒë·ªÉ update IP
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/Z1jmxhd.png"/>
    <img loading="lazy" src="https://i.imgur.com/rVESLTd.png"/>
</figure>

T·∫£i [**"DDNS Updater Admin**"](https://ddnsupdater.videocoding.org/download.html) v·ªÅ m·ªü l√™n. ƒêi·ªÅn URL d∆∞·ªõi ƒë√¢y, thay b·∫±ng domain c·ªßa b·∫°n, v√† account password c·ªßa b·∫°n

```bash
https://domains.google.com/nic/update?hostname=nhvu95.com&myip=%IP%
```
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/BItUqPZ.png"/>
</figure>

B·∫£n th√¢n th·∫±ng `**DDNS Updater Admin**` n√†y c≈©ng check IP c·ªßa b·∫°n theo th·ªùi gian t·ª´ c√°c ngu·ªìn web online nh∆∞:

- http://[icanhazip.com]/
- http://[www.trackip.net]/ip
- http://[ip.appspot.com]/  
...

M√¨nh kh√¥ng ƒëi·ªÅn c√°i IPv4 update URL v√¨ nh∆∞ ƒë√£ n√≥i ·ªü tr√™n, Public IPv4 l·∫•y v·ªÅ to√†n sai, v√¨ v·∫≠y m√¨nh ch·ªâ d√πng duy nh·∫•t IPv6.

Sau khi Save, Apply b·∫°n reload l·∫°i trang Google Domain, th·∫•y domain ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t IPv6 gi·ªëng h√¨nh c·ªßa m√¨nh th√¨ l√† th√†nh c√¥ng.

**_T·ª´ gi·ªù ph√∫t n√†y b·∫°n ƒë√£ c√≥ th·ªÉ truy c·∫≠p trang web b·∫±ng domain c·ªßa b·∫°n_**

## **5. Ki·ªÉm tra th·ª≠ v√† ph√°t hi·ªán l·ªói.**

M·ªçi th·ª© ho·∫°t ƒë·ªông r·∫•t ·ªïn cho ƒë·∫øn khi m√¨nh ph√°t hi·ªán ra m√¨nh kh√¥ng th·ªÉ truy c·∫≠p website c·ªßa m√¨nh b·∫±ng 4G tr√™n ƒëi·ªán tho·∫°i.  
ƒêi·ªán tho·∫°i n·∫øu k·∫øt n·ªëi wifi th√¨ v√†o ƒë∆∞·ª£c, ho·∫∑c n·∫øu d√πng 4G v√† b·∫≠t VPN (Warp 1111) th√¨ v√†o ngon l√†nh, nh∆∞ng t·∫Øt ƒëi th√¨ ch·ªãu.  
Ch·∫≥ng nh·∫Ω trang web c·ªßa m√¨nh ƒë√£ b·ªã ƒë·ªëi x·ª≠ nh∆∞ po*nhub üòû. M√¨nh c√≤n ƒë√£ ki·ªÉm tra domain c·ªßa m√¨nh (nhvu95.com) c√≥ khi n√†o c√≥ ch·ªØ "vu" b·ªã hi·ªÉu nh·∫ßm th√†nh ch·ªØ "v.√∫" kh√¥ng c∆° üòÅ. R·∫•t may qua comment c·ªßa c√°c anh em ƒë√£ gi·∫£i th√≠ch cho m√¨nh

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/Bqmeqgy.png"/>
</figure>

M√¨nh ki·ªÉm tra th√¨ ƒë√∫ng th·∫ø th·∫≠t :O, H∆°n n·ªØa IPv4 l·∫•y ƒë∆∞·ª£c c√≤n l√† IPv4 c·ªßa ISP Viettel, ƒê√¢y c√≥ l·∫Ω ch√≠nh l√† l√Ω do m√† d√π ·ªü ph√≠a server m√¨nh c√≥ tr·ªè DDNS ƒë·∫øn WAN IPv4 (C√°i trong modem setting) c·ªßa m√¨nh th√¨ ƒëi·ªán tho·∫°i c≈©ng kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c.
Tuy nhi√™n khi d√πng Wifi ho·∫∑c VPN th√¨ IPv6 v√† IPv4 c·ªßa ƒëi·ªán tho·∫°i ƒë·ªÅu ƒë∆∞·ª£c c·∫•p b√¨nh th∆∞·ªùng üòÅ. Ki·∫øn th·ª©c m·ªõi n√†y ƒë√£ ƒë∆∞·ª£c ti·∫øp thu üòÄ.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/q3fgRqh.jpg"/>
</figure>
_______________

# II. **T·ª± host v√† d√πng Cloudflare ƒë·ªÉ facing v·ªõi internet th√¥ng qua Cloudflare tunnel.**
### Solution
Thay v√¨ public port v√† r·ªìi c·∫•u h√¨nh DDNS m·ªôt ƒë·ªëng th·ª© t·ª´a l∆∞a kh√°c gi·ªëng nh∆∞ c√°ch 1, th√¨ ƒë·∫°i kh√°i ƒë√¢y s·∫Ω l√† c√°ch m√† ch√∫ng ta l√†m l·∫°i.
Cloudflare s·∫Ω gi√∫p ch√∫ng ta x·ª≠ l√Ω v·ª• ƒë·ªãnh tuy·∫øn, IP c√°c th·ª© lo·∫±ng ngo·∫±ng b√™n tr√™n, ch√∫ng ta ch·ªâ c·∫ßn c·∫•u h√¨nh `Cloudflare tunnel` tr·ªè ƒë·∫øn server c·ªßa ch√∫ng ta l√† ƒë∆∞·ª£c.

Sau khi c√≥ ƒë∆∞·ª£c keyword v·ªÅ `Cloudflare tunnel` v√† t√¨m hi·ªÉu n√≥, m√¨nh th·∫•y n√≥ kh√° gi·ªëng v·ªõi `ngrok` m·ªôt trong nh·ªØng th·ª© m√¨nh t·ª´ng d√πng ng√†y tr∆∞·ªõc. `Ngrok` c≈©ng cho ph√©p publich localhost nh∆∞ng s·∫Ω ph·∫£i s·ª≠ d·ª•ng domain c·ªßa `ngrok`.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/QEKfpK1.png"/>
</figure>

Tr√™n h√¨nh th√¨ s·∫Ω c√≥ c√°c services c·ªßa Cloudflare, nh∆∞ng th·ª±c ra th√¨ n·∫øu ch·ªâ self-host kh√¥ng th√¥i th√¨ kh√¥ng c·∫ßn d√πng ƒë·∫øn c√°c th·ª© ƒë√≥.  
Nh·ªØng th·ª© b·∫°n c·∫ßn chu·∫©n b·ªã cho gi·∫£i ph√°p n√†y

- Domain
- Cloudflare account
- Server c√≥ k·∫øt n·ªëi m·∫°ng

## 1. Con Docker v√† Nginx c·∫•u h√¨nh t∆∞∆°ng t·ª± nh∆∞ gi·∫£i ph√°p 1
Ch√∫ng ta c·ª© gi·ªØ nguy√™n ph·∫ßn n√†y
## 2. C·∫•u h√¨nh con domain (Google Domain) c·ªßa m√¨nh sang d√πng DNS server c·ªßa Cloudflare.

Vi·ªác ƒëƒÉng k√Ω account Cloudflare r·∫•t d·ªÖ r·ªìi, c√°c b·∫°n t·ª± m√≤.

Sau khi login Cloudflare s·∫Ω ƒëi·ªÅu h∆∞·ªõng ch√∫ng ta ƒë·∫øn m·ªôt trang qu·∫£n tr·ªã. Vi·ªác ch√∫ng ta c·∫ßn l√†m ƒë·∫ßu ti√™n l√† tr·ªè Domain c·ªßa ch√∫ng ta ƒë·∫øn Clouldflare ƒë√£.

Ch·ªçn `Websites > Add a Site` v√† ƒëi·ªÅn domain c·ªßa b·∫°n v√†o ƒë√¢y, r·ªìi sau ƒë√≥ ·∫•n Next.
VD: nhvu95.com.
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/Aq1DcKa.png"/>
</figure>


S·∫Ω c√≥ 4 plan ƒë·ªÉ cho ch√∫ng ta ch·ªçn, ·ªü ƒë√¢y nhu c·∫ßu c·ªßa m√¨nh ch·ªâ d√πng ƒë·∫øn Free plan, n√™n m√¨nh ch·ªçn free plan. N·∫øu c√≥ nhu c·∫ßu ch·ªçn nh·ªØng plan m·∫•t ph√≠, b·∫°n c·∫ßn ph·∫£i add th√™m th·∫ª visa/mastercard tr∆∞·ªõc khi ti·∫øp t·ª•c (`Billing > Payment Info`), c√≤n n·∫øu b·∫°n kh√¥ng c√≥ nhu c·∫ßu, ch√∫ng ta c√≥ th·ªÉ ti·∫øp t·ª•c qua b∆∞·ªõc ti·∫øp theo.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/2tcWPoh.png"/>
</figure>

1. Ch·ªçn > `Continue`

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/XSuYcMW.png"/>
</figure>

2. M·ªôt dialog hi·ªán l√™n ƒë·ªÉ confirm v·ªÅ vi·ªác Add records later, ch·ªçn > `Confirm`
3. Copy 2 Cloudflare name server ·ªü m√†n h√¨nh ti·∫øp theo v√† paste ra notepad ho·∫∑c ch·ªó n√†o ƒë√≥ ƒë·ªÉ d√πng sau n√†y.

```
xxxx.ns.Cloudflare.com
xxxx.ns.Cloudflare.com
```
4. M√†n h√¨nh ti·∫øp theo s·∫Ω ƒë∆∞a c√°c b·∫°n ƒë·∫øn 1 c√°i quicks-start guide. ·ªû ƒë√¢y s·∫Ω c√≥ c√°c tu·ª≥ ch·ªçn cho ph√©p b·∫°n t·ªëi ∆∞u security hay performance cho domain c·ªßa m√¨nh. 
V√≠ d·ª• nh∆∞:
- Rewrite l·∫°i HTTPS, n·∫øu b·∫°n b·∫≠t c√°i n√†y th√¨ b·∫°n kh√¥ng c·∫ßn generate SSL cert t·ª´ Certbot n·ªØa c≈©ng ƒë∆∞·ª£c ( Ch·∫Øc v·∫≠y üòÅ m√¨nh c≈©ng ch∆∞a th·ª≠).
- Ho·∫∑c tu·ª≥ ch·ªçn lu√¥n lu√¥n s·ª≠ d·ª•ng HTTPS
- Tu·ª≥ ch·ªçn auto minify JS, CSS, HTML. Ho·∫∑c n√©n Brotli ƒë·ªÉ load trang nhanh h∆°n

T√∫m l·∫°i l√† mu·ªën d√πng c√°i n√†o th√¨ c·∫•u h√¨nh c√°i ƒë√≥, tu·ª≥ m·ªói ng∆∞·ªùi.

B·∫•m ch·ªçn > `Finish`

5. L√∫c n√†y Cloudflare s·∫Ω ƒë∆∞a b·∫°n ƒë·∫øn m·ªôt m√†n h√¨nh Overview. T·∫°m k·ªá n√≥ ·ªü ƒë√≥ ƒë√£. Vi·ªác ch√∫ng ta c·∫ßn l√†m l√∫c n√†y l√† m·ªü tab kh√°c v√† v·ªÅ trang qu·∫£n l√Ω domain.

B·∫•t k√¨ platform b√°n domain n√†o c≈©ng s·∫Ω c√≥ ch·ªó ƒë·ªÉ c·∫•u h√¨nh DNS Server, d√π l√† Google Domain, Name cheap, Godady...  
M·ªü ph·∫ßn ƒë√≥ l√™n v√† ƒëi·ªÅn 2 DNS server ƒë√£ copy tr∆∞·ªõc ƒë√≥ v√†o, r·ªìi > `L∆∞u`.
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/b2PbGXI.png"/>
</figure>

S·∫Ω m·∫•t 1 l√∫c ƒë·ªÉ domain c√≥ th·ªÉ ho·∫°t ƒë·ªông, c√°c b·∫°n quay v·ªÅ tab > `Websites` c·ªßa Cloudflare v√† th·∫•y domain ƒë√£ ƒë∆∞·ª£c t√≠ch xanh th√¨ c√≥ nghƒ©a l√† ƒë√£ th√†nh c√¥ng.
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/j3UXVab.png"/>
</figure>

V·∫≠y l√† ƒë√£ xong b∆∞·ªõc c·∫•u h√¨nh domain.

## **3. T·∫°o Application tr√™n Cloudflare**


T·ª´ thanh c√¥ng c·ª• C·ªßa Clouldflare, ch·ªçn > `Zero Trust`. Cloudflare s·∫Ω ƒë∆∞a b·∫°n ƒë·∫øn Dashboard c·ªßa Cloudflare Zero Trust.

T·∫°i ƒë√¢y, ch√∫ng ta ch·ªçn `Access` > `Application` > `Add an application` > `Self-hosted`.

**\> Configure App** - Config domain, path v√† t√™n app

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/gwlHpsW.png"/>
</figure>

**\> Add policies** - Config policies ƒë·ªÉ truy c·∫≠p app  
- N·∫øu mu·ªën public ƒë·ªÉ t·∫•t c·∫£ m·ªçi ng∆∞·ªùi c√≥ th·ªÉ truy c·∫≠p, b·∫°n n√™n ch·ªçn `Action` l√† `Bypass` v√† ·ªü ph·∫ßn `Includes` ƒë·ªÉ l√† `Everyone`. C√≤n n·∫øu mu·ªën gi·ªõi h·∫°n nh·ªØng ng∆∞·ªùi c√≥ th·ªÉ truy c·∫≠p, vd theo email, ip, location th√¨ b·∫°n c√≥ th·ªÉ tu·ª≥ ch·ªânh, khi ƒë√≥ mu·ªën xem ƒë∆∞·ª£c trang c·ªßa b·∫°n b·∫Øt bu·ªôc user ph·∫£i ƒëƒÉng nh·∫≠p th√¥ng qua 1 page login c·ªßa Cloudflare g·ªçi l√† Cloudflare Access tr√¥ng nh∆∞ th·∫ø n√†y.

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/nwDVja1.png" alt="JS components"/>
</figure>


**\> CORS settings** - CORS, Cookie, etc
- ·ªû b∆∞·ªõc n√†y s·∫Ω cho ph√©p b·∫°n b·∫≠t t·∫Øt CORS, filter c√°c resful method nh∆∞ GET, PUT, POST ..etc
- V√† ·ªü ƒë√¢y c≈©ng c√≥ tu·ª≥ ch·ªçn kh√°c v·ªÅ Cookie..

Ch·ªçn > `Add application` ƒê·ªÉ t·∫°o 1 application

## **4. T·∫°o Tunnel v√† connect server ƒë·∫øn Cloudflare tunnel**

T·ª´ Zero Trust Dashboard, ch·ªçn `Access` > `Tunnels` > `Create a tunnel`.

- ƒê·ªÅn t√™n tunnel > `Save tunnel`

·ªû b∆∞·ªõc `> Install connector`, tu·ª≥ thu·ªôc v√†o h·ªá ƒëi·ªÅu h√†nh m√† server s·ª≠ d·ª•ng s·∫Ω c√≥ c√°ch c√†i ƒë·∫∑t kh√°c nhau. Nh√¨n chung m·∫•y th·∫±ng kia kh√¥ng c√≥ g√¨ kh√≥. Docker th√¨ h∆°i d·ªã ch√∫t v√¨ ph·∫£i c·∫•u h√¨nh network.

M√¨nh d√πng Docker - Nginx ƒë·ªÉ serve website n√™n m√¨nh c≈©ng d√πng lu√¥n docker tunnel cho ti·ªán qu·∫£n l√Ω.

\> Ch·ªçn `Docker` > Copy command

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/YOrBrXG.png" alt="JS components"/>
</figure>

s·ª≠a m·ªôt ch√∫t cho command tr√¥ng gi·ªëng nh∆∞ sau v√† ch·∫°y

```
docker run --detach --restart unless-stopped --network tunnel Cloudflare/Cloudflared:latest tunnel --no-autoupdate run --token eyJhIjoiZDxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

N·∫øu k·∫øt n·ªëi ƒë·∫øn tunnel th√†nh c√¥ng, IP v√† connector ID s·∫Ω xu·∫•t hi·ªán ·ªü ph·∫ßn `Connectors` ph√≠a d∆∞·ªõi khung c·ª≠a s·ªï. ·∫§n > `Next`

T·∫°i b∆∞·ªõc c·∫•u h√¨nh > **Route tunnel**, b·∫°n ch·ªçn domain k·∫øt n·ªëi ƒë·∫øn tunnel n√†y
Ri√™ng v·ªÅ ph·∫ßn services: b·∫°n ƒëi·ªÅn http://localhost/. N·∫øu b·∫°n serve tr√™n docker th√¨ h∆°i kh√°c 1 ch√∫t, b·∫°n ph·∫£i ƒë·ªÉ l√† static local IP c·ªßa b·∫°n th√¨ n√≥ m·ªõi ƒÉn http://192.168.1.50:80.  
ƒê√¢y c√≥ l·∫Ω l√† v·∫•n ƒë·ªÅ c·ªßa Cocker/Cloudflare tunnel. M√¨nh m·∫•t g·∫ßn 1 bu·ªïi m·ªõi t√¨m ra c√°ch x·ª≠ l√Ω üòû

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/ZQYJAdH.png" alt="JS components"/>
</figure>

N·∫øu c√≥ nhi·ªÅu sub domain, b·∫°n c·ª© save n√≥ l·∫°i tr∆∞·ªõc ƒë√£ r·ªìi quay tr·ªü v·ªÅ m√†n h√¨nh List `tunnels` > ch·ªçn `Configure`.

·ªû tab Public Hostname, b·∫°n add th√™m public hostname cho sub domain

<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/MMuM4HT.png" alt="JS components"/>
</figure>

Khi t·∫°o tunnel th√†nh c√¥ng. B·∫°n quay tr·ªü v·ªÅ Cloudflare Dashboard, ch·ªçn domain v·ª´a c·∫•u h√¨nh.
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/qX1ErOH.png" alt="JS components"/>
</figure>
<figure align="center" width="100%">
    <img loading="lazy" src="https://i.imgur.com/SSTP5d0.png" alt="JS components"/>
</figure>

L√∫c n√†y nh·ªØng DNS Records m·ªõi s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông t·∫°o ra cho domain c·ªßa b·∫°n ƒë·ªÉ k·∫øt n·ªëi ƒë·∫øn Tunnel, ri√™ng 2 record `_domainconnect` v√† `_dmarc` gi·ªëng nh∆∞ tr√™n h√¨nh, n·∫øu nh∆∞ ch√∫ng kh√¥ng c√≥ th√¨ b·∫°n ch·ªâ c·∫ßn t·ª± t·∫°o th√™m l√† ƒë∆∞·ª£c.

V√† Yes. ƒê·∫øn l√∫c n√†y th√¨ to√†n b·∫°n ƒë√£ c√≥ th·ªÉ ho√†n to√†n truy c·∫≠p website c·ªßa m√¨nh r·ªìi ƒë√≥.

Ch√∫c c√°c b·∫°n th√†nh c√¥ng.

https://nhvu95.com/  
https://f2f.nhvu95.com/#/

_____________

**Note ri√™ng cho Angular/Scully:** Sau khi s·ª≠ d·ª•ng Scully - angular host tr√™n nginx c√πng v·ªõi Cloudflare, Th√¨ th·∫±ng Optimization c·ªßa Cloudflare n√≥ s·∫Ω l√†m h·ªèng ki·∫øn tr√∫c c·ªßa Scully. Issue v·ªÅ n√≥ m√¨nh c≈©ng ƒë√£ t√¨m th·∫•y ·ªü ƒë√¢y: https://github.com/scullyio/scully/issues/131

**Gi·∫£i ph√°p 1:** `Website` > `<domain_name>` > `Caching`> `Configuration` > V√† b·∫≠t ch·∫ø ƒë·ªô Dev mode c·ªßa n√≥ l√™n l√† ƒë∆∞·ª£c. Tuy nhi√™n CDN s·∫Ω kh√¥ng cache n·ªØa, s·∫Ω l√†m tƒÉng th·ªùi gian load static html.  
**Gi·∫£i ph√°p 2:** `Website` > `<domain_name>` > `Speed`> `Optimization` > `Auto Minify` v√† b·ªè ch·ªçn minify c·ªßa HTML ƒëi l√† ƒë∆∞·ª£c

